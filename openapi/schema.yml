openapi: 3.0.0
info:
  version: 1.0.0
  title: Hojokin Dock API
  description: "補助金ドックのAPIドキュメント"
servers:
  - url: "http://localhost:3000"
tags:
  - name: subsidy
    description: 補助金情報
  - name: ministry
    description: 省庁
  - name: prefecture
    description: 都道府県
  - name: city
    description: 市長区村
  - name: business_category
    description: 業種
  - name: admin/company
    description: 会社管理
  - name: admin/user
    description: ユーザー管理
  - name: admin/subsidy
    description: 補助金情報管理
paths:
  "/subsidies":
    parameters:
      - name: keyword
        in: query
        description: キーワード検索
        schema:
          type: string
      - name: start_from
        in: query
        description: 募集開始日
        schema:
          type: string
          format: date
      - name: end_to
        in: query
        description: 募集終了日
        schema:
          type: string
          format: date
      - name: business_categories
        in: query
        description: 業種ID配列
        style: pipeDelimited
        explode: false
        schema:
          type: array
          items:
            type: string
            example: seizo
      - name: prefecture_ids
        in: query
        description: 都道府県ID配列
        style: pipeDelimited
        explode: false
        schema:
          type: array
          items:
            type: string
            example: 1
      - name: city_ids
        in: query
        description: 市長区村ID配列
        style: pipeDelimited
        explode: false
        schema:
          type: array
          items:
            type: string
            example: 1
      - name: ministry_ids
        in: query
        description: 省庁ID配列
        style: pipeDelimited
        explode: false
        schema:
          type: array
          items:
            type: string
            example: 1
    get:
      tags:
        - subsidy
      summary: 補助金情報一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - subsidies
                properties:
                  subsidies:
                    type: array
                    items:
                      "$ref": "#/components/schemas/subsidy"
  "/subsidies/{id}":
    parameters:
      - name: id
        in: path
        required: true
        description: subsidyのid
        schema:
          type: integer
    get:
      tags:
        - subsidy
      summary: 補助金情報詳細
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/subsidy"
  "/ministries":
    get:
      tags:
        - ministry
      summary: 省庁一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - ministries
                properties:
                  ministries:
                    type: array
                    items:
                      "$ref": "#/components/schemas/ministry"
  "/prefectures":
    get:
      tags:
        - prefecture
      summary: 都道府県一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - prefectures
                properties:
                  prefectures:
                    type: array
                    items:
                      "$ref": "#/components/schemas/prefecture"
  "/prefectures/{id}/cities":
    parameters:
      - name: id
        in: path
        required: true
        description: prefectureのid
        schema:
          type: integer
    get:
      tags:
        - city
      summary: 市長区村一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - cities
                properties:
                  cities:
                    type: array
                    items:
                      "$ref": "#/components/schemas/city"
  "/business_categories":
    get:
      tags:
        - business_category
      summary: 業種一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - business_categories
                properties:
                  business_categories:
                    type: array
                    items:
                      "$ref": "#/components/schemas/business_category"
  "/admin/companies":
    get:
      tags:
        - admin/company
      summary: 会社一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - companies
                properties:
                  companies:
                    type: array
                    items:
                      "$ref": "#/components/schemas/company"
    post:
      tags:
        - admin/company
      summary: 会社作成
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/company_update"
      responses:
        "201":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/company"
  "/admin/companies/{id}":
    parameters:
      - name: id
        in: path
        required: true
        description: companyのid
        schema:
          type: integer
    get:
      summary: 会社詳細
      tags:
        - admin/company
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/company"
    put:
      summary: 会社更新
      tags:
        - admin/company
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/company_update"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/company"
  "/admin/users":
    get:
      tags:
        - admin/user
      summary: ユーザー一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - users
                properties:
                  users:
                    type: array
                    items:
                      "$ref": "#/components/schemas/user"
    post:
      tags:
        - admin/user
      summary: ユーザー作成
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - display_name
                - account_role
              properties:
                email:
                  type: string
                  description: email
                  example: taro.tanaka@example.com
                display_name:
                  type: string
                  description: ユーザー名
                  example: 田中太郎
                account_role:
                  "$ref": "#/components/schemas/account_role"
      responses:
        "201":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/user"
  "/admin/users/{id}":
    parameters:
      - name: id
        in: path
        required: true
        description: userのid
        schema:
          type: integer
    get:
      summary: ユーザー詳細
      tags:
        - admin/user
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/user"
    put:
      summary: ユーザー更新
      tags:
        - admin/user
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - display_name
                - email
                - account_role
              properties:
                display_name:
                  type: string
                  description: ユーザー名
                  example: 田中太郎
                email:
                  type: string
                  description: email
                  example: taro.tanaka@example.com
                account_role:
                  "$ref": "#/components/schemas/account_role"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/user"
  "/admin/subsidy_drafts":
    get:
      tags:
        - admin/subsidy
      summary: スクレイピング取得URL一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - subsidy_drafts
                properties:
                  subsidy_drafts:
                    type: array
                    items:
                      "$ref": "#/components/schemas/subsidy_draft"
  "/admin/subsidy_drafts/{id}":
    parameters:
      - name: id
        in: path
        required: true
        description: subsidy_draftのid
        schema:
          type: integer
    get:
      tags:
        - admin/subsidy
      summary: スクレイピング取得URL一覧
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/subsidy_draft"
  "/admin/subsidies":
    get:
      summary: 補助金情報一覧
      tags:
        - admin/subsidy
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  subsidies:
                    type: array
                    items:
                      "$ref": "#/components/schemas/subsidy"
    post:
      tags:
        - admin/subsidy
      summary: 補助金情報作成
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/subsidy_update"
      responses:
        "201":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/subsidy"
  "/admin/subsidies/{id}":
    parameters:
      - name: id
        in: path
        required: true
        description: userのid
        schema:
          type: integer
    get:
      summary: 補助金情報詳細
      tags:
        - admin/subsidy
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/subsidy"
    put:
      summary: 補助金情報更新
      tags:
        - admin/subsidy
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/subsidy_update"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/subsidy"
components:
  schemas:
    subsidy:
      type: object
      required:
        - id
        - title
        - url
        - start_from
        - end_to
        - price_max
        - support_ratio_min
        - support_ratio_max
        - level
        - detail
        - target_detail
        - supplier_type
        - ministry
        - prefecture
        - city
        - business_categories
      properties:
        id:
          type: integer
          description: id
          example: 1
        title:
          type: string
          description: 補助金名
          example: IT導入補助金
        url:
          type: string
          description: URL
          example: https://www.it-hojo.jp/applicant/
        subsidy_category:
          type: string
          description: 種類
          enum:
            - hojo
            - josei
        start_from:
          type: string
          format: date
          description: 募集期間（開始日）
          example: "2022-01-01"
        end_to:
          type: string
          format: date
          description: 募集期間（終了日）
          example: "2022-02-01"
          nullable: true
        price_max:
          type: integer
          description: 最大支援金額
          example: 60000000
          nullable: true
        support_ratio_min:
          type: string
          description: 支援割合（最小）
          example: 1/2
          nullable: true
        support_ratio_max:
          type: string
          description: 支援割合（最大）
          example: 3/4
          nullable: true
        level:
          type: integer
          description: 申請難易度
          example: 4
          nullable: true
        detail:
          type: string
          description: 詳細文章
          example: 新型コロナウイルス感染症の影響が長期化し、当面の需要や売上の回復が期待し難い中、ウィズコロナ・ポストコロナの時代の経済社会の変化に対応するために新分野展開、業態転換、事業・業種転換、事業再編又はこれらの取組を通じた規模の拡大等、思い切った事業再構築に意欲を有する中小企業等の挑戦を支援することで、日本経済の構造転換を促すことを目的とします。※申請の受付は11月17日より開始となりました。
        ministry:
          "$ref": "#/components/schemas/ministry"
        prefecture:
          "$ref": "#/components/schemas/prefecture"
        city:
          "$ref": "#/components/schemas/city"
        supplier_type:
          type: string
          description: 発行機関
          enum:
            - ministry
            - prefecture
            - city
        business_categories:
          type: array
          items:
            "$ref": "#/components/schemas/business_category"
    subsidy_update:
      type: object
      required:
        - title
        - url
        - start_from
      properties:
        title:
          type: string
          description: 補助金名
          example: IT導入補助金
        publishing_code:
          type: string
          description: 公開状況
          enum:
            - published
            - editing
        url:
          type: string
          description: URL
          example: https://www.it-hojo.jp/applicant/
        subsidy_category:
          type: string
          description: 種類
          enum:
            - hojo
            - josei
        start_from:
          type: string
          format: date
          description: 募集期間（開始日）
          example: "2022-01-01"
        end_to:
          type: string
          format: date
          description: 募集期間（終了日）
          example: "2022-02-01"
        price_max:
          type: integer
          description: 最大支援金額
          example: 60000000
        support_ratio_min:
          type: string
          description: 支援割合（最小）
          example: 1/2
        support_ratio_max:
          type: string
          description: 支援割合（最大）
          example: 3/4
        level:
          type: integer
          description: 申請難易度
          example: 4
        detail:
          type: string
          description: 詳細文章
          example: 新型コロナウイルス感染症の影響が長期化し、当面の需要や売上の回復が期待し難い中、ウィズコロナ・ポストコロナの時代の経済社会の変化に対応するために新分野展開、業態転換、事業・業種転換、事業再編又はこれらの取組を通じた規模の拡大等、思い切った事業再構築に意欲を有する中小企業等の挑戦を支援することで、日本経済の構造転換を促すことを目的とします。※申請の受付は11月17日より開始となりました。
        ministry_id:
          type: integer
          description: 省庁ID
          example: 4
        prefecture_id:
          type: integer
          description: 省庁ID
          example: 4
        city_id:
          type: integer
          description: 省庁ID
          example: 4
        supplier_type:
          type: string
          description: 発行機関
          enum:
            - ministry
            - prefecture
            - city
        business_categories:
          type: array
          items:
            type: string
            example: seizo
    ministry:
      type: object
      nullable: true
      required:
        - id
        - name
        - logo_url
      properties:
        id:
          type: integer
          description: id
          example: 1
        name:
          type: string
          description: 省庁名
          example: 経済産業省
        logo_url:
          type: string
          description: URL
          example: https://example.com/logo.png
    prefecture:
      type: object
      nullable: true
      required:
        - id
        - name
        - logo_url
      properties:
        id:
          type: integer
          description: id
          example: 1
        name:
          type: string
          description: 都道府県名
          example: 東京都
        logo_url:
          type: string
          description: URL
          example: https://example.com/logo.png
    city:
      type: object
      nullable: true
      required:
        - id
        - name
        - logo_url
      properties:
        id:
          type: integer
          description: id
          example: 1
        name:
          type: string
          description: 市町区村名
          example: 千代田区
        logo_url:
          type: string
          description: URL
          example: https://example.com/logo.png
    business_category:
      type: object
      nullable: true
      required:
        - key
        - name
      properties:
        key:
          type: string
          description: enumのkey
          example: seizo
        name:
          type: string
          description: 業種名
          example: 製造業
    company:
      type: object
      required:
        - id
        - name
        - capital
        - total_employee
        - prefecture
        - city
      properties:
        id:
          type: integer
          description: id
          example: 1
        name:
          type: string
          description: 会社名
          example: つくば株式会社
        capital:
          type: integer
          description: 資本金
          example: 10000000
        total_employee:
          type: integer
          description: 従業員数
          example: 100
        prefecture:
          "$ref": "#/components/schemas/prefecture"
        city:
          "$ref": "#/components/schemas/city"
        business_categories:
          type: array
          items:
            "$ref": "#/components/schemas/business_category"
    company_update:
      type: object
      required:
        - name
        - capital
        - total_employee
        - prefecture_id
        - city_id
        - business_categories
      properties:
        name:
          type: string
          description: 会社名
          example: つくば株式会社
        capital:
          type: integer
          description: 資本金
          example: 10000000
        total_employee:
          type: integer
          description: 従業員数
          example: 100
        prefecture_id:
          type: integer
          description: 都道府県ID
          example: 1
        city_id:
          type: integer
          description: 市長区村ID
          example: 1
        business_categories:
          type: array
          items:
            type: string
            description: 業種enum
            example: seizo
    user:
      type: object
      required:
        - id
        - display_name
        - email
        - firebase_uid
        - account_role
        - company
      properties:
        id:
          type: integer
          description: ユーザーID
          example: 1
        display_name:
          type: string
          description: ユーザー名
          example: 田中太郎
        email:
          type: string
          description: email
          example: taro.tanaka@example.com
        firebase_uid:
          type: string
          description: firebaseのuid
          example: xxxxxxxxxxxxxxxxxxxx
        account_role:
          "$ref": "#/components/schemas/account_role"
        company:
          type: object
          required:
            - id
            - name
          properties:
            id:
              type: integer
              description: id
              example: 1
            name:
              type: string
              description: 会社名
              example: つくば株式会社
    account_role:
      type: string
      description: アカウント種類
      enum:
        - user
        - editor
        - admin
    subsidy_draft:
      type: object
      required:
        - title
        - url
      properties:
        title:
          type: string
          description: 取得URLタイトル
        url:
          type: string
          description: URL
        ministry:
          "$ref": "#/components/schemas/ministry"
        prefecture:
          "$ref": "#/components/schemas/prefecture"
        city:
          "$ref": "#/components/schemas/city"
        supplier_type:
          type: string
          description: 発行機関
          nullable: true
          enum:
            - ministry
            - prefecture
            - city
